
#include <openssl/opensslconf.h>
#include "crypto/chacha.h"
#include "crypto/riscv_arch.h"

void ChaCha20_ctr32_v_zbb_zvkb(unsigned char *out, const unsigned char *inp,
                               size_t len, const unsigned int key[8],
                               const unsigned int counter[4]);

void ChaCha20_ctr32_v_zbb(unsigned char *out, const unsigned char *inp,
                          size_t len, const unsigned int key[8],
                          const unsigned int counter[4]);

void ChaCha20_ctr32(unsigned char *out, const unsigned char *inp, size_t len,
                    const unsigned int key[8], const unsigned int counter[4])
{
    if (len > CHACHA_BLK_SIZE && RISCV_HAS_ZBB() && riscv_vlen() >= 128
            && (size_t)out % sizeof(size_t) == 0
            && (size_t)inp % sizeof(size_t) == 0) {
        if (RISCV_HAS_ZVKB()) {
            ChaCha20_ctr32_v_zbb_zvkb(out, inp, len, key, counter);
        } else {
            ChaCha20_ctr32_v_zbb(out, inp, len, key, counter);
        }
    } else {
        ChaCha20_ctr32_c(out, inp, len, key, counter);
    }
}